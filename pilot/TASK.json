{
  "v": 5,
  "id": "WP-060",
  "milestone": "M7",
  "goal": "Set up vitest test framework for unit and integration tests",

  "context": {
    "why": "Tests are essential for validating the runner's behavior. Vitest provides fast, modern testing with TypeScript support. This task sets up the foundation for fixture-based testing.",
    "deps": [],
    "extract": "From PRD: Fixtures define the contract (CI-ready). Tests validate critical paths: scope enforcement, verification safety, diff limits, rollback, etc."
  },

  "subtasks": [
    "1. Install vitest and related dependencies",
    "2. Create vitest.config.ts with TypeScript support",
    "3. Add test script to package.json",
    "4. Create tests/ directory structure",
    "5. Add sample test for src/lib/fs.ts (atomic writes)",
    "6. Add sample test for src/lib/schema.ts (validation)",
    "7. Verify tests run with pnpm test"
  ],

  "implementation": {
    "dependencies": [
      "vitest (dev)",
      "@vitest/coverage-v8 (dev, optional)"
    ],
    "vitest_config": {
      "test.include": ["tests/**/*.test.ts"],
      "test.globals": true,
      "resolve.alias": "@ -> src/"
    },
    "directory_structure": {
      "tests/": "test files",
      "tests/lib/": "unit tests for src/lib/",
      "tests/fixtures/": "fixture test data (future)"
    }
  },

  "scope": {
    "write": ["vitest.config.ts", "tests/**/*.ts"],
    "create_under": ["tests/"],
    "read_forbidden": [".env*", "*.pem", "*.key"],
    "forbidden": ["pilot/*", "relais/*", "src/**"]
  },

  "acceptance": [
    "vitest installed and configured",
    "pnpm test runs successfully",
    "At least 2 sample tests pass",
    "TypeScript paths work in tests",
    "pnpm build still succeeds"
  ],

  "verify": ["pnpm build", "pnpm test"],
  "risk": "LOW",
  "notes": [
    "This is foundation work - actual fixture tests come in WP-061/062",
    "Can modify package.json to add test script"
  ]
}
