{
  "v": 5,
  "id": "WP-165",
  "milestone": "M17",
  "goal": "Acceptance test: External builder timeout kills child and returns STOP_BUILDER_TIMEOUT",

  "context": {
    "why": "NEW-PLAN.md acceptance test: Verify that cursor mode timeout enforcement works - child process is killed and STOP_BUILDER_TIMEOUT is returned.",
    "deps": ["WP-164"],
    "ref": "docs/NEW-PLAN.md lines 312-320 (PR5 timeout rules)"
  },

  "subtasks": [
    {
      "id": "1",
      "title": "Create external builder timeout test",
      "file": "tests/runner/cursor-timeout.test.ts",
      "action": "CREATE",
      "description": "Create an acceptance test that verifies cursor mode timeout handling. Mock or create a slow command that exceeds timeout, verify STOP_BUILDER_TIMEOUT is returned in validationErrors.",
      "code_hint": "import { describe, it, expect } from 'vitest';\n// Test handleCursorMode timeout behavior\n// Options:\n// 1. Mock execFileAsync to simulate timeout error (killed: true, signal: 'SIGTERM')\n// 2. Use a real slow command like 'sleep 10' with 1 second timeout\n// Verify result has:\n// - success: false\n// - validationErrors includes 'STOP_BUILDER_TIMEOUT'\n// - rawResponse mentions timeout"
    }
  ],

  "scope": {
    "write": [],
    "create_under": ["tests/runner"],
    "read_forbidden": [".env*", "*.pem", "*.key"],
    "forbidden": ["pilot/*"]
  },

  "acceptance": [
    "Test file tests/runner/cursor-timeout.test.ts exists",
    "Test verifies timeout returns STOP_BUILDER_TIMEOUT",
    "Test verifies success is false on timeout",
    "Test passes with pnpm test"
  ],

  "verify": ["pnpm typecheck", "pnpm test"],
  "risk": "LOW",

  "builder": {
    "mode": "cursor"
  },

  "notes": [
    "Can mock execFileAsync or use real 'sleep' command with short timeout",
    "The timeout error from Node has killed=true and signal='SIGTERM' or 'SIGKILL'",
    "handleCursorMode checks for these properties to detect timeout",
    "This completes M17 - all acceptance tests done"
  ]
}
