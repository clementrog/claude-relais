{
  "v": 5,
  "id": "WP-042",
  "milestone": "M5",
  "goal": "Implement diff limits enforcement to check files_touched and lines_changed limits",

  "context": {
    "why": "Judge must verify that diff size doesn't exceed task limits. If files_touched > max_files_touched OR lines_changed > max_lines_changed → STOP(diff_too_large).",
    "deps": ["WP-040"],
    "extract": "From PRD Section 10: Diff size exceeds limits (files_touched > max_files_touched OR lines_changed > max_lines_changed) → STOP(STOP_DIFF_TOO_LARGE). Blast radius summary: '<files_touched> files, +<lines_added>/-<lines_deleted>, <new_files> new'."
  },

  "subtasks": [
    "1. Add checkDiffLimits function to src/lib/diff.ts",
    "2. Create DiffLimitCheckResult interface with ok, violation details",
    "3. Check files_touched against task.diff_limits.max_files_touched",
    "4. Check lines_changed (added + deleted) against task.diff_limits.max_lines_changed",
    "5. Create formatBlastRadius function to generate summary string",
    "6. Export new functions from src/lib/index.ts"
  ],

  "implementation": {
    "DiffLimitCheckResult_interface": {
      "ok": "boolean - true if within limits",
      "files_touched": "number - actual files touched",
      "lines_changed": "number - actual lines changed (added + deleted)",
      "max_files": "number - limit from task",
      "max_lines": "number - limit from task",
      "violation": "string | null - description if limits exceeded"
    },
    "blast_radius_format": "<files_touched> files, +<lines_added>/-<lines_deleted>, <new_files> new",
    "lines_changed_calc": "lines_added + lines_deleted"
  },

  "scope": {
    "write": ["src/lib/diff.ts", "src/lib/index.ts"],
    "create_under": [],
    "read_forbidden": [".env*", "*.pem", "*.key"],
    "forbidden": ["pilot/*", "relais/*", "package.json"]
  },

  "acceptance": [
    "checkDiffLimits detects when files_touched exceeds max_files_touched",
    "checkDiffLimits detects when lines_changed exceeds max_lines_changed",
    "formatBlastRadius returns correct summary string format",
    "Returns ok=true when within limits",
    "pnpm build succeeds"
  ],

  "verify": ["pnpm build"],
  "risk": "LOW",
  "notes": [
    "Uses DiffAnalysis from WP-040 as input",
    "DiffLimits type from task.diff_limits"
  ]
}
