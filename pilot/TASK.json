{
  "v": 5,
  "id": "WP-081",
  "milestone": "M9",
  "goal": "Add new guardrail STOP codes",

  "context": {
    "why": "Guardrails require new STOP codes for loop detection, timeout classification, and merge safety.",
    "deps": ["WP-080"],
    "extract": "From Guardrails spec: STOP_REDISPATCH_IDENTICAL_TASK (same fingerprint after failure), STOP_VERIFY_FLAKY_OR_TIMEOUT (verify timeout/flaky), STOP_MERGE_DIRTY_WORKTREE (dirty worktree at merge), STOP_BRANCH_MISMATCH (wrong branch), STOP_EVIDENCE_INCOMPLETE (missing evidence for MED/HIGH)."
  },

  "subtasks": [
    "1. Add STOP_REDISPATCH_IDENTICAL_TASK to StopCode in src/types/report.ts",
    "2. Add STOP_VERIFY_FLAKY_OR_TIMEOUT to StopCode",
    "3. Add STOP_MERGE_DIRTY_WORKTREE to StopCode",
    "4. Add STOP_BRANCH_MISMATCH to StopCode",
    "5. Add STOP_EVIDENCE_INCOMPLETE to StopCode",
    "6. Update relais/schemas/report.schema.json with new codes"
  ],

  "implementation": {
    "new_codes": [
      "STOP_REDISPATCH_IDENTICAL_TASK",
      "STOP_VERIFY_FLAKY_OR_TIMEOUT",
      "STOP_MERGE_DIRTY_WORKTREE",
      "STOP_BRANCH_MISMATCH",
      "STOP_EVIDENCE_INCOMPLETE"
    ],
    "meanings": {
      "STOP_REDISPATCH_IDENTICAL_TASK": "Next TASK fingerprint equals last failed fingerprint",
      "STOP_VERIFY_FLAKY_OR_TIMEOUT": "Verify command timed out or classified as flaky",
      "STOP_MERGE_DIRTY_WORKTREE": "Worktree not clean when attempting merge",
      "STOP_BRANCH_MISMATCH": "Current branch doesn't match STATE.branch",
      "STOP_EVIDENCE_INCOMPLETE": "MED/HIGH task missing required evidence in REPORT"
    }
  },

  "scope": {
    "write": ["src/types/report.ts", "relais/schemas/report.schema.json"],
    "create_under": [],
    "read_forbidden": [".env*", "*.pem", "*.key"],
    "forbidden": ["pilot/*", "src/lib/**", "tests/**"]
  },

  "acceptance": [
    "All 5 new STOP codes added to StopCode type",
    "report.schema.json enum updated with new codes",
    "pnpm build succeeds"
  ],

  "verify": ["pnpm build"],
  "risk": "LOW",
  "notes": [
    "Type-only changes, no implementation logic yet",
    "Implementation will come in subsequent tasks"
  ]
}
