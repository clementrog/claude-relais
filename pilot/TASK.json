{
  "v": 5,
  "id": "WP-043",
  "milestone": "M5",
  "goal": "Implement verification command execution using argv arrays (no shell)",

  "context": {
    "why": "Judge must execute verification commands safely without shell injection risk. Commands use argv arrays with spawn, not shell strings. Templates from config define cmd+args with optional parameter placeholders.",
    "deps": ["WP-044"],
    "extract": "From PRD Section 11: Verification commands are templates defined in config as cmd+args arrays. Must use argv/no-shell, spawn(cmd, [...args], {shell:false}). Timeouts from config (timeout_fast_seconds, timeout_slow_seconds)."
  },

  "subtasks": [
    "1. Create src/lib/verify.ts module for verification execution",
    "2. Create VerificationRun interface with template_id, exit_code, stdout, stderr, duration_ms, success",
    "3. Implement executeVerification(template, params, timeout): runs single verification",
    "4. Use spawn with shell:false for security",
    "5. Implement interpolateArgs(args, params): replace {{param}} placeholders",
    "6. Handle timeouts using AbortController or setTimeout+kill",
    "7. Create runVerifications(templates, task, config): runs fast then slow verifications",
    "8. Export from src/lib/index.ts"
  ],

  "implementation": {
    "VerificationRun_interface": {
      "template_id": "string - ID of the verification template",
      "exit_code": "number - process exit code",
      "stdout": "string - captured stdout",
      "stderr": "string - captured stderr",
      "duration_ms": "number - execution time",
      "success": "boolean - exit_code === 0"
    },
    "spawn_options": {
      "shell": false,
      "stdio": "['pipe', 'pipe', 'pipe']",
      "timeout": "from config timeout_fast_seconds or timeout_slow_seconds"
    },
    "param_interpolation": "Replace {{param_name}} in args with validated param values"
  },

  "scope": {
    "write": ["src/lib/verify.ts", "src/lib/index.ts"],
    "create_under": ["src/lib/"],
    "read_forbidden": [".env*", "*.pem", "*.key"],
    "forbidden": ["pilot/*", "relais/*", "package.json"]
  },

  "acceptance": [
    "executeVerification runs command using spawn with shell:false",
    "Command timeouts are enforced",
    "stdout/stderr are captured",
    "Exit code is returned correctly",
    "Parameter placeholders are interpolated in args",
    "pnpm build succeeds"
  ],

  "verify": ["pnpm build"],
  "risk": "MED",
  "notes": [
    "WP-044 implements parameter validation (metachar rejection) - this task assumes params are already validated",
    "Templates come from config.verification.templates",
    "Fast verifications run first, then slow verifications"
  ]
}
